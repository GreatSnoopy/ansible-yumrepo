yumrepo
=======

Role which helps to manage YUM repositories.


Examples
--------

This role can be used either from playbook (section `roles`):

```
---

# Example of how to use the role in playbook
- hosts: myhost
  vars:
    # Prevent to delete CoreOS-Base repo file. Basically any repo file which is
    # not managed by the yumrepo role and is not listed in this variable will be
    # deleted.
    yumrepo_ignore_repo_files:
      - CentOS-Base
  roles:
    - role: yumrepo
      # This adds one new repo file (/etc/yum.repos.d/base.repo)
      yumrepo_repos:
        base:
          name: Base repo
          baseurl: http://myserver
    # This adds two new repo files (/etc/yum.repos.d/app1{A,B}.repo)
    - role: yumrepo
      yumrepo_repos:
        app1A:
          name: App1-A repo
          baseurl: http://myserver
          gpgcheck: 0
        app1B:
          name: App1-B repo
          baseurl: http://myserver
          gpgcheck: 0
    # This adds another one repo file (/etc/yum.repos.d/app2.repo)
    - role: yumrepo
      yumrepo_repos:
        app2:
          name: App2 repo
          baseurl: http://myserver
          gpgcheck: 0
    # When we have finished with setting up YUM repos, we have to call this:
    - role: yumrepo
      yumrepo_finish: true
```

Or it can be used in the meta file (section `dependencies`) of another role:

```
---

# Example of how to use the role in meta file
galaxy_info:
  author: John Doe
  description: Role for App1
  license: MIT
  min_ansible_version: 1.7
  platforms:
    - name: Debian
      versions:
        - all
    - name: EL
      versions:
        - all
  categories:
    - web
dependencies:
  # This adds one new repo file (/etc/yum.repos.d/app3.repo)
  - role: yumrepo
    yumrepo_repos:
      - app3repo:
          name: App3 repo
          baseurl: http://myserver
          gpgcheck: 0
    when: ansible_os_family == 'RedHat'
  # We can finish the YUM repos building here or back in the playbook
  #- role: yumrepo
  #  yumrepo_finish: true
```

The `yumrepo_finish` variable can be set in a final play placed at the end of the
playbook. This requires to share any global variables used by the `yumrepo` role
(e.g. `yumrepo_repos_ignore`) across all plays with `vars_files`.

```
---

- hosts: myhost1
  vars_file: vars/shared.yaml
  roles:
    - role: yumrepo
      yumrepo_repos:
        appreponame1:
          name: App repo 1
          baseurl: http://myserver1

- hosts: myhost2
  vars_file: vars/shared.yaml
  roles:
    - role: yumrepo
      yumrepo_repos:
        appreponame2:
          name: App repo 2
          baseurl: http://myserver2

- hosts: all
  name: Final play
  roles:
    - role: yumrepo
      yumrepo_finish: yes
```

This role deletes all unmanaged repos at the end of the play. So if a repo
definition is removed from the play (`roles`) or from the role (`dependencies`),
it will remove the repo file at the end of the play. All depends on the content
of the `/etc/yum.repos.d/.managed` file which is generated by this role when the
`yumrepo_finish` variable is set to `true`. This allows to create YUM repos
across multiple roles and once all is done, it will generate the `.managed` file
and clean the unmanaged repos.


Role variables
--------------

List of variables used by the role:

```
---

# Repository configuration
yumrepo_repos: []
# Example
#yumrepo_repos:
#  # ID of the repository
#  test:
#    # Additional parameters
#    name: Testing repo
#    baseurl: http://myserver/
#    enabled: 1
#    gpgcheck: 0
#    metadata_expire: 1

# Default list of repos files which won't be deleted during the clearing process
yumrepo_ignore_repos: []
# Example:
#yumrepo_ignore_repos:
#  - CentOS-Base

# To cleanup the temp directory and generate the .managed file
yumrepo_finish: false
```


License
-------

MIT


Author
------

Jiri Tyr
